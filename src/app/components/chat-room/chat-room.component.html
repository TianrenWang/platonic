<div class="container-fluid">
  <div class="row">

    <!-- Display currently active chat -->
    <div class="col-sm-3 col-lg-2 active-list-container" [ngClass]="{open: showActive}">
      <app-active-list></app-active-list>
    </div>

    <div class="col-sm-9 col-lg-10 column">
      <div class="panel panel-primary chat-container">
        <div class="panel-heading text-center clearfix">
          <!-- <button class="btn btn-warning btn-sm pull-left hidden-atw" type="button" name="active" (click)="onUsersClick()"></button> -->
          {{chatService.getChatWith()}}
        </div>
        <!-- <div class="panel-body msg-container" [ngClass]="{blurred: showActive}"></div> -->
        <div class="panel-body msg-container" [ngClass]="{blurred: showActive}">

          <!-- Argument Box -->
          <mat-card *ngIf="(chatroom$ | async).activeChannel && (chatroom$ | async).activeChannel.attributes.argument" class="argument">

            <!-- Argument Message -->
            <mat-card-content>
              <h3>Argument</h3>
              <p>{{(chatroom$ | async).activeChannel.attributes.argument.message}}</p>

              <h3 *ngIf="textingRight$ | async">You currently have texting right.</h3>
              <h3 *ngIf="!(textingRight$ | async)">Other user has texting right.</h3>

              <!-- Button for yielding texting right -->
              <button mat-mini-fab
                (click)="passTextingRight()"
                [disabled]="!(textingRight$ | async)">
                <mat-icon>sync_alt</mat-icon>
              </button>
            </mat-card-content>

            <!-- The message that was flagged for needing source -->
            <mat-card-content>
              <h3>A source was demanded for the following message.</h3>
              <p>blah blah blah</p>
              <form [formGroup]="sendSource"
                (ngSubmit)="onSendSource()"
                >

                <div class="input-group">
                  <input type="text"
                    class="form-control"
                    placeholder="Type your source..."
                    id="source"
                    name="source"
                    formControlName="source"
                    autofocus="true"
                    autocomplete="off"
                    >

                  <span class="input-group-btn">
                    <button
                      [disabled]="sendSource.invalid"
                      type="submit" class="btn btn-primary" name="send">Send</button>
                  </span>
                </div>
              </form>
            </mat-card-content>

            <!-- Buttons for selecting agreement state -->
            <mat-card-actions>
              <button
                *ngIf="(agreeArgument$ | async) as color"
                mat-raised-button color={{color}}
                (click)="onAgreementClick(agreement.AGREE)">
                  Agree
              </button>
              <button 
                *ngIf="(middleArgument$ | async) as color"
                mat-raised-button color={{color}}
                (click)="onAgreementClick(agreement.MIDDLE)">Middle</button>
              <button 
                *ngIf="(disagreeArgument$ | async) as color"
                mat-raised-button color={{color}}
                (click)="onAgreementClick(agreement.DISAGREE)">Disagree</button>
            </mat-card-actions>
          </mat-card>
          
          <app-message
            *ngFor="let message of (chatroom$ | async).messages"
            [message]="message"
            [debate]='(chatroom$ | async).activeChannel.attributes.debate'
            (rebut)="indicateRebut($event)">
          </app-message>
          <p *ngIf="(chatroom$ | async).channels.length === 0">You are not part of any chat.</p>
        </div>

        <!-- The message input form -->
        <div class="panel-footer" [ngClass]="{blurred: showActive}">
          <form [formGroup]="sendForm"
            (ngSubmit)="onSendSubmit()"
            >

            <div class="input-group">
              <input type="text"
                class="form-control"
                placeholder="Type your message..."
                id="message"
                name="message"
                formControlName="message"
                autofocus="true"
                autocomplete="off"
                >

              <span class="input-group-btn">
                <button
                  [disabled]="sendForm.invalid || !(chatroom$ | async).activeChannel || !(textingRight$ | async)"
                  type="submit" class="btn btn-primary" name="send">Send</button>
                <button type="button" class="btn btn-secondary" (click)="onEndChat()">End Chat</button>
              </span>
            </div>
          </form>
        </div>

        <div *ngIf="notify" class="well notification">
          <h4><strong>{{notification.from}}</strong> <span *ngIf="notification.inChatRoom">to chat-room</span>:</h4>
          <p>{{notification.text}}</p>
        </div>
      </div>
    </div>
  </div>

</div>

<audio id="notifSound" src="assets/audio/notification.mp3" type="audio/mpeg">
<audio id="msgSound" src="assets/audio/message.mp3" type="audio/mpeg">

</audio>

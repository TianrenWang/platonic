<mat-drawer-container style="height: 100%;">
  <mat-drawer #drawer [mode]='"over"' style="width: 300px;">
    <div [ngClass]="{open: showActive}">
      <app-active-list></app-active-list>
    </div>
  </mat-drawer>
  <mat-drawer-content>

    <!-- Header -->
    <mat-toolbar class="header" color="primary">
      <span>Name</span>
      <span style="flex: 1 1 auto;"></span>

      <!-- Button for turning on sidenav to switch chat -->
      <button mat-button (click)="drawer.toggle()">Switch Chat</button>

      <!-- Button for ending chat -->
      <button mat-button (click)="onEndChat()">End Chat</button>
    </mat-toolbar>

    <!-- Argument Box -->
    <mat-card *ngIf="(chatroom$ | async).activeChannel && (chatroom$ | async).activeChannel.attributes.argument" class="argument">

      <!-- Argument Message -->
      <mat-card-content>
        <h3>Argument</h3>
        <p>{{(chatroom$ | async).activeChannel.attributes.argument.message}}</p>

        <h3 *ngIf="textingRight$ | async">You currently have texting right.</h3>
        <h3 *ngIf="!(textingRight$ | async)">Other user has texting right.</h3>

        <!-- Button for yielding texting right -->
        <button mat-mini-fab
          (click)="passTextingRight()"
          [disabled]="!(textingRight$ | async)">
          <mat-icon>sync_alt</mat-icon>
        </button>
      </mat-card-content>

      <!-- The message that was flagged for needing source -->
      <mat-card-content *ngIf="(flaggedMessage$ | async) as flaggedMessage">
        <h3>A source was demanded for the following message.</h3>
        <p>{{flaggedMessage}}</p>
        <form [formGroup]="sendSource"
          (ngSubmit)="onSendSource()"
          >

          <div class="input-group">
            <input type="text"
              class="form-control"
              placeholder="Type your source..."
              id="source"
              name="source"
              formControlName="source"
              autofocus="true"
              autocomplete="off"
              >

            <span class="input-group-btn">
              <button
                [disabled]="sendSource.invalid"
                type="submit" class="btn btn-primary" name="send">Send</button>
            </span>
          </div>
        </form>
      </mat-card-content>

      <!-- Buttons for selecting agreement state -->
      <mat-card-actions>
        <button
          *ngIf="(agreeArgument$ | async) as color"
          mat-raised-button color={{color}}
          (click)="onAgreementClick(agreement.AGREE)">
            Agree
        </button>
        <button 
          *ngIf="(middleArgument$ | async) as color"
          mat-raised-button color={{color}}
          (click)="onAgreementClick(agreement.MIDDLE)">Middle</button>
        <button 
          *ngIf="(disagreeArgument$ | async) as color"
          mat-raised-button color={{color}}
          (click)="onAgreementClick(agreement.DISAGREE)">Disagree</button>
      </mat-card-actions>
    </mat-card>

    <!-- All messages -->
    <div class="msg-container">
      <app-message
        *ngFor="let message of (chatroom$ | async).messages"
        [message]="message"
        [debate]='(chatroom$ | async).activeChannel.attributes.debate'
        (rebut)="indicateRebut($event)">
      </app-message>
      <p *ngIf="(chatroom$ | async).channels.length === 0">You are not part of any chat.</p>
    </div>

    <!-- Footer -->
    <span style="position: fixed; bottom: 0%; height: 45px;">

      <!-- The message input form -->
      <div [ngClass]="{blurred: showActive}">
        <form [formGroup]="sendForm"
          (ngSubmit)="onSendSubmit()"
          >

          <div class="input-group">
            <input type="text"
              class="form-control"
              placeholder="Type your message..."
              id="message"
              name="message"
              formControlName="message"
              autofocus="true"
              autocomplete="off"
              >

            <span class="input-group-btn">
              <button
                [disabled]="sendForm.invalid || !(chatroom$ | async).activeChannel || !(textingRight$ | async) || (flaggedMessage$ | async)"
                type="submit" class="btn btn-primary" name="send">Send</button>
            </span>
          </div>
        </form>
      </div>
    </span>
  </mat-drawer-content>
</mat-drawer-container>

<audio id="notifSound" src="assets/audio/notification.mp3" type="audio/mpeg">
<audio id="msgSound" src="assets/audio/message.mp3" type="audio/mpeg">

</audio>
